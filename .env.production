# GovCon AI Pipeline - Production Environment (Cost-Optimized)
# Copy this to .env and fill in your values

# ============================================================================
# REQUIRED: Database Configuration
# ============================================================================
POSTGRES_URL=postgresql://bronze:CHANGE_ME@postgres:5432/govcon
POSTGRES_USER=bronze
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD
POSTGRES_DB=govcon

# ============================================================================
# REQUIRED: Redis Cache
# ============================================================================
REDIS_URL=redis://redis:6379/0
# Max memory already set to 128MB in docker-compose for cost optimization

# ============================================================================
# REQUIRED: AI Model API Keys
# ============================================================================
# COST OPTIMIZATION: Use only one provider, OpenAI is recommended
# GPT-4o-mini is cost-effective for most tasks (~$0.15-0.60 per 1M tokens)
# Use GPT-4o only for complex reasoning tasks
OPENAI_API_KEY=sk-proj-...
ANTHROPIC_API_KEY=sk-ant-...  # Optional, comment out if not using

# Default model selection (use cost-effective models)
DEFAULT_MODEL=gpt-4o-mini  # Cost-effective default
EXPENSIVE_MODEL=gpt-4o     # Use sparingly for complex tasks

# ============================================================================
# REQUIRED: External API Keys
# ============================================================================
SAM_GOV_API_KEY=your_sam_gov_api_key_here
BLS_API_KEY=your_bls_api_key_here  # Optional but recommended for pricing

# ============================================================================
# Vector Database
# ============================================================================
QDRANT_URL=http://qdrant:6333
# Memory-mapped threshold optimized in docker-compose

# ============================================================================
# Object Storage - MinIO (Local)
# ============================================================================
# COST OPTIMIZATION NOTE: Consider migrating to Cloudflare R2 for production
# R2 offers 10GB free storage and zero egress fees
# See scripts/migrate-to-r2.sh for migration guide

MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=bronze
MINIO_SECRET_KEY=CHANGE_ME_STRONG_SECRET
MINIO_BUCKET=govcon-artifacts
MINIO_USE_SSL=false

# Cloudflare R2 Configuration (optional, more cost-effective)
# USE_CLOUDFLARE_R2=true
# R2_ACCOUNT_ID=your_account_id
# R2_ACCESS_KEY_ID=your_access_key
# R2_SECRET_ACCESS_KEY=your_secret_key
# R2_BUCKET_NAME=govcon-artifacts
# R2_PUBLIC_BUCKET_URL=https://pub-xxxxx.r2.dev

# ============================================================================
# API Configuration
# ============================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=2  # Optimized for 4GB VPS
API_LOG_LEVEL=info
API_URL=https://api.yourdomain.com

# ============================================================================
# Security & Authentication
# ============================================================================
# Generate strong keys with: python -c "import secrets; print(secrets.token_urlsafe(32))"
JWT_SIGNING_KEY=CHANGE_ME_GENERATE_STRONG_KEY
SESSION_SECRET_KEY=CHANGE_ME_GENERATE_STRONG_KEY
ENCRYPTION_KEY=CHANGE_ME_32_BYTE_HEX_KEY

AUTH_ISSUER=https://yourdomain.com/
AUTH_AUDIENCE=govcon-api

# ============================================================================
# Company Configuration
# ============================================================================
COMPANY_NAME=The Bronze Shield
COMPANY_DESIGNATIONS=SDVOSB,VOSB,SB
COMPANY_DUNS=your_duns_number
COMPANY_CAGE_CODE=your_cage_code
COMPANY_UEI=your_uei_number

# Allowed NAICS codes (comma-separated)
ALLOWED_NAICS=541512,541511,541519,541513,541690,541611,541930,561410,518210,541990

# Allowed PSC codes (comma-separated)
ALLOWED_PSC=D301,D302,D307,D308,D310,D314,D316,D318,D399,R408,R410,R413,R420,R499,R699,R608,U012,U099

# Set-aside preferences (priority order)
SET_ASIDE_PREFS=SDVOSB,VOSB,SB

# ============================================================================
# Feature Flags
# ============================================================================
DEBUG=false
TESTING=false
REQUIRE_PINK_TEAM_APPROVAL=true
REQUIRE_GOLD_TEAM_APPROVAL=true
ENABLE_AUDIT_LOGGING=true

# COST OPTIMIZATION: Disable Ollama in production
USE_LOCAL_LLM=false
# OLLAMA_HOST=http://ollama:11434  # Commented out for production

# ============================================================================
# Monitoring & Logging (Optional)
# ============================================================================
# Sentry (optional, but recommended for error tracking)
# SENTRY_DSN=https://xxx@sentry.io/xxx
# SENTRY_ENVIRONMENT=production
# SENTRY_TRACES_SAMPLE_RATE=0.1  # Low sample rate for cost optimization

# Log retention
LOG_RETENTION_DAYS=7  # Keep logs for 7 days to save disk space

# ============================================================================
# Performance Tuning
# ============================================================================
# Database connection pool (optimized for low-memory VPS)
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=5

# Rate limiting (requests per minute)
RATE_LIMIT_PER_MINUTE=60

# Request timeout (seconds)
REQUEST_TIMEOUT=30

# ============================================================================
# Backup Configuration
# ============================================================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=7
# S3-compatible backup target (use Cloudflare R2 for free backups)
# BACKUP_S3_ENDPOINT=https://xxx.r2.cloudflarestorage.com
# BACKUP_S3_BUCKET=govcon-backups
# BACKUP_S3_ACCESS_KEY=xxx
# BACKUP_S3_SECRET_KEY=xxx

# ============================================================================
# Email Notifications (Optional)
# ============================================================================
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USERNAME=your_email@gmail.com
# SMTP_PASSWORD=your_app_password
# SMTP_FROM_EMAIL=noreply@yourdomain.com

# Notification recipients
# ALERT_EMAIL=admin@yourdomain.com

# ============================================================================
# Domain Configuration
# ============================================================================
DOMAIN=yourdomain.com
API_DOMAIN=api.yourdomain.com
ADMIN_EMAIL=admin@yourdomain.com

# ============================================================================
# COST OPTIMIZATION TIPS
# ============================================================================
# 1. Use gpt-4o-mini for most tasks (90% cost reduction vs GPT-4)
# 2. Enable aggressive caching (Redis TTL configured)
# 3. Migrate to Cloudflare R2 for object storage (free tier)
# 4. Use low sample rate for Sentry (0.1 = 10% of traces)
# 5. Keep log retention to 7 days
# 6. Monitor API usage and set up billing alerts
# 7. Consider batch processing for non-urgent tasks
# 8. Use connection pooling (already configured)
# 9. Enable compression (configured in Caddy)
# 10. Regularly clean up old opportunities/proposals
